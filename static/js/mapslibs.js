function RichMarker(n){var t=n||{};this.ready_=!1,this.dragging_=!1,n.visible==undefined&&(n.visible=!0),n.shadow==undefined&&(n.shadow="7px -3px 5px rgba(88,88,88,0.7)"),n.anchor==undefined&&(n.anchor=RichMarkerPosition.BOTTOM),this.setValues(t)}RichMarker.prototype=new google.maps.OverlayView,window.RichMarker=RichMarker,RichMarker.prototype.getVisible=function(){return this.get("visible")},RichMarker.prototype.getVisible=RichMarker.prototype.getVisible,RichMarker.prototype.setVisible=function(n){this.set("visible",n)},RichMarker.prototype.setVisible=RichMarker.prototype.setVisible,RichMarker.prototype.visible_changed=function(){this.ready_&&(this.markerWrapper_.style.display=this.getVisible()?"":"none",this.draw())},RichMarker.prototype.visible_changed=RichMarker.prototype.visible_changed,RichMarker.prototype.setFlat=function(n){this.set("flat",!!n)},RichMarker.prototype.setFlat=RichMarker.prototype.setFlat,RichMarker.prototype.getFlat=function(){return this.get("flat")},RichMarker.prototype.getFlat=RichMarker.prototype.getFlat,RichMarker.prototype.getWidth=function(){return this.get("width")},RichMarker.prototype.getWidth=RichMarker.prototype.getWidth,RichMarker.prototype.getHeight=function(){return this.get("height")},RichMarker.prototype.getHeight=RichMarker.prototype.getHeight,RichMarker.prototype.setShadow=function(n){this.set("shadow",n),this.flat_changed()},RichMarker.prototype.setShadow=RichMarker.prototype.setShadow,RichMarker.prototype.getShadow=function(){return this.get("shadow")},RichMarker.prototype.getShadow=RichMarker.prototype.getShadow,RichMarker.prototype.flat_changed=function(){this.ready_&&(this.markerWrapper_.style.boxShadow=this.markerWrapper_.style.webkitBoxShadow=this.markerWrapper_.style.MozBoxShadow=this.getFlat()?"":this.getShadow())},RichMarker.prototype.flat_changed=RichMarker.prototype.flat_changed,RichMarker.prototype.setZIndex=function(n){this.set("zIndex",n)},RichMarker.prototype.setZIndex=RichMarker.prototype.setZIndex,RichMarker.prototype.getZIndex=function(){return this.get("zIndex")},RichMarker.prototype.getZIndex=RichMarker.prototype.getZIndex,RichMarker.prototype.zIndex_changed=function(){this.getZIndex()&&this.ready_&&(this.markerWrapper_.style.zIndex=this.getZIndex())},RichMarker.prototype.zIndex_changed=RichMarker.prototype.zIndex_changed,RichMarker.prototype.getDraggable=function(){return this.get("draggable")},RichMarker.prototype.getDraggable=RichMarker.prototype.getDraggable,RichMarker.prototype.setDraggable=function(n){this.set("draggable",!!n)},RichMarker.prototype.setDraggable=RichMarker.prototype.setDraggable,RichMarker.prototype.draggable_changed=function(){this.ready_&&(this.getDraggable()?this.addDragging_(this.markerWrapper_):this.removeDragListeners_())},RichMarker.prototype.draggable_changed=RichMarker.prototype.draggable_changed,RichMarker.prototype.getPosition=function(){return this.get("position")},RichMarker.prototype.getPosition=RichMarker.prototype.getPosition,RichMarker.prototype.setPosition=function(n){this.set("position",n)},RichMarker.prototype.setPosition=RichMarker.prototype.setPosition,RichMarker.prototype.position_changed=function(){this.draw()},RichMarker.prototype.position_changed=RichMarker.prototype.position_changed,RichMarker.prototype.getAnchor=function(){return this.get("anchor")},RichMarker.prototype.getAnchor=RichMarker.prototype.getAnchor,RichMarker.prototype.setAnchor=function(n){this.set("anchor",n)},RichMarker.prototype.setAnchor=RichMarker.prototype.setAnchor,RichMarker.prototype.anchor_changed=function(){this.draw()},RichMarker.prototype.anchor_changed=RichMarker.prototype.anchor_changed,RichMarker.prototype.htmlToDocumentFragment_=function(n){var t=document.createElement("DIV"),i;if(t.innerHTML=n,t.childNodes.length==1)return t.removeChild(t.firstChild);for(i=document.createDocumentFragment();t.firstChild;)i.appendChild(t.firstChild);return i},RichMarker.prototype.removeChildren_=function(n){if(n)for(var t;t=n.firstChild;)n.removeChild(t)},RichMarker.prototype.setContent=function(n){this.set("content",n)},RichMarker.prototype.setContent=RichMarker.prototype.setContent,RichMarker.prototype.getContent=function(){return this.get("content")},RichMarker.prototype.getContent=RichMarker.prototype.getContent,RichMarker.prototype.content_changed=function(){var n,t,u,i,r;if(this.markerContent_){if(this.removeChildren_(this.markerContent_),n=this.getContent(),n){for(typeof n=="string"&&(n=n.replace(/^\s*([\S\s]*)\b\s*$/,"$1"),n=this.htmlToDocumentFragment_(n)),this.markerContent_.appendChild(n),t=this,u=this.markerContent_.getElementsByTagName("IMG"),i=0;r=u[i];i++)google.maps.event.addDomListener(r,"mousedown",function(n){t.getDraggable()&&(n.preventDefault&&n.preventDefault(),n.returnValue=!1)}),google.maps.event.addDomListener(r,"load",function(){t.draw()});google.maps.event.trigger(this,"domready")}this.ready_&&this.draw()}},RichMarker.prototype.content_changed=RichMarker.prototype.content_changed,RichMarker.prototype.setCursor_=function(n){if(this.ready_){var t="";navigator.userAgent.indexOf("Gecko/")!==-1?(n=="dragging"&&(t="-moz-grabbing"),n=="dragready"&&(t="-moz-grab"),n=="draggable"&&(t="pointer")):((n=="dragging"||n=="dragready")&&(t="move"),n=="draggable"&&(t="pointer")),this.markerWrapper_.style.cursor!=t&&(this.markerWrapper_.style.cursor=t)}},RichMarker.prototype.startDrag=function(n){if(this.getDraggable()&&!this.dragging_){this.dragging_=!0;var t=this.getMap();this.mapDraggable_=t.get("draggable"),t.set("draggable",!1),this.mouseX_=n.clientX,this.mouseY_=n.clientY,this.setCursor_("dragready"),this.markerWrapper_.style.MozUserSelect="none",this.markerWrapper_.style.KhtmlUserSelect="none",this.markerWrapper_.style.WebkitUserSelect="none",this.markerWrapper_.unselectable="on",this.markerWrapper_.onselectstart=function(){return!1},this.addDraggingListeners_(),google.maps.event.trigger(this,"dragstart")}},RichMarker.prototype.stopDrag=function(){this.getDraggable()&&this.dragging_&&(this.dragging_=!1,this.getMap().set("draggable",this.mapDraggable_),this.mouseX_=this.mouseY_=this.mapDraggable_=null,this.markerWrapper_.style.MozUserSelect="",this.markerWrapper_.style.KhtmlUserSelect="",this.markerWrapper_.style.WebkitUserSelect="",this.markerWrapper_.unselectable="off",this.markerWrapper_.onselectstart=function(){},this.removeDraggingListeners_(),this.setCursor_("draggable"),google.maps.event.trigger(this,"dragend"),this.draw())},RichMarker.prototype.drag=function(n){var r,u,t,i;if(!this.getDraggable()||!this.dragging_){this.stopDrag();return}r=this.mouseX_-n.clientX,u=this.mouseY_-n.clientY,this.mouseX_=n.clientX,this.mouseY_=n.clientY,t=parseInt(this.markerWrapper_.style.left,10)-r,i=parseInt(this.markerWrapper_.style.top,10)-u,this.markerWrapper_.style.left=t+"px",this.markerWrapper_.style.top=i+"px";var f=this.getOffset_(),e=new google.maps.Point(t-f.width,i-f.height),o=this.getProjection();this.setPosition(o.fromDivPixelToLatLng(e)),this.setCursor_("dragging"),google.maps.event.trigger(this,"drag")},RichMarker.prototype.removeDragListeners_=function(){this.draggableListener_&&(google.maps.event.removeListener(this.draggableListener_),delete this.draggableListener_),this.setCursor_("")},RichMarker.prototype.addDragging_=function(n){if(n){var t=this;this.draggableListener_=google.maps.event.addDomListener(n,"mousedown",function(n){t.startDrag(n)}),this.setCursor_("draggable")}},RichMarker.prototype.addDraggingListeners_=function(){var n=this;this.markerWrapper_.setCapture?(this.markerWrapper_.setCapture(!0),this.draggingListeners_=[google.maps.event.addDomListener(this.markerWrapper_,"mousemove",function(t){n.drag(t)},!0),google.maps.event.addDomListener(this.markerWrapper_,"mouseup",function(){n.stopDrag(),n.markerWrapper_.releaseCapture()},!0)]):this.draggingListeners_=[google.maps.event.addDomListener(window,"mousemove",function(t){n.drag(t)},!0),google.maps.event.addDomListener(window,"mouseup",function(){n.stopDrag()},!0)]},RichMarker.prototype.removeDraggingListeners_=function(){if(this.draggingListeners_){for(var n=0,t;t=this.draggingListeners_[n];n++)google.maps.event.removeListener(t);this.draggingListeners_.length=0}},RichMarker.prototype.getOffset_=function(){var r=this.getAnchor(),n,t,i;if(typeof r=="object")return r;if(n=new google.maps.Size(0,0),!this.markerContent_)return n;t=this.markerContent_.offsetWidth,i=this.markerContent_.offsetHeight;switch(r){case RichMarkerPosition.TOP:n.width=-t/2;break;case RichMarkerPosition.TOP_RIGHT:n.width=-t;break;case RichMarkerPosition.LEFT:n.height=-i/2;break;case RichMarkerPosition.MIDDLE:n.width=-t/2,n.height=-i/2;break;case RichMarkerPosition.RIGHT:n.width=-t,n.height=-i/2;break;case RichMarkerPosition.BOTTOM_LEFT:n.height=-i;break;case RichMarkerPosition.BOTTOM:n.width=-t/2,n.height=-i;break;case RichMarkerPosition.BOTTOM_RIGHT:n.width=-t,n.height=-i}return n},RichMarker.prototype.onAdd=function(){var n,t;this.markerWrapper_||(this.markerWrapper_=document.createElement("DIV"),this.markerWrapper_.style.position="absolute"),this.getZIndex()&&(this.markerWrapper_.style.zIndex=this.getZIndex()),this.markerWrapper_.style.display=this.getVisible()?"":"none",this.markerContent_||(this.markerContent_=document.createElement("DIV"),this.markerWrapper_.appendChild(this.markerContent_),n=this,google.maps.event.addDomListener(this.markerContent_,"click",function(){google.maps.event.trigger(n,"click")}),google.maps.event.addDomListener(this.markerContent_,"mouseover",function(){google.maps.event.trigger(n,"mouseover")}),google.maps.event.addDomListener(this.markerContent_,"mouseout",function(){google.maps.event.trigger(n,"mouseout")})),this.ready_=!0,this.content_changed(),this.flat_changed(),this.draggable_changed(),t=this.getPanes(),t&&t.overlayMouseTarget.appendChild(this.markerWrapper_),google.maps.event.trigger(this,"ready")},RichMarker.prototype.onAdd=RichMarker.prototype.onAdd,RichMarker.prototype.draw=function(){var n,t,i;if(this.ready_&&!this.dragging_&&(n=this.getProjection(),n)){var f=this.get("position"),r=n.fromLatLngToDivPixel(f),u=this.getOffset_();this.markerWrapper_.style.top=r.y+u.height+"px",this.markerWrapper_.style.left=r.x+u.width+"px",t=this.markerContent_.offsetHeight,i=this.markerContent_.offsetWidth,i!=this.get("width")&&this.set("width",i),t!=this.get("height")&&this.set("height",t)}},RichMarker.prototype.draw=RichMarker.prototype.draw,RichMarker.prototype.onRemove=function(){this.markerWrapper_&&this.markerWrapper_.parentNode&&this.markerWrapper_.parentNode.removeChild(this.markerWrapper_),this.removeDragListeners_()},RichMarker.prototype.onRemove=RichMarker.prototype.onRemove;var RichMarkerPosition={TOP_LEFT:1,TOP:2,TOP_RIGHT:3,LEFT:4,MIDDLE:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM:8,BOTTOM_RIGHT:9};window.RichMarkerPosition=RichMarkerPosition